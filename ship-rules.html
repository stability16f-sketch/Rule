<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KR STABILITY</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(to bottom, #1e3a8a 0%, #3b82f6 50%, #0ea5e9 100%);
            position: relative;
            overflow-x: hidden;
        }

        /* ë°”ë‹¤ ì• ë‹ˆë©”ì´ì…˜ */
        .ocean {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom,
                rgba(30, 58, 138, 0.3) 0%,
                rgba(59, 130, 246, 0.5) 50%,
                rgba(14, 165, 233, 0.7) 100%);
            z-index: 0;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 150px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,50 Q300,0 600,50 T1200,50 L1200,120 L0,120 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: 600px 120px;
            animation: wave 15s linear infinite;
        }

        .wave:nth-child(2) {
            bottom: 20px;
            opacity: 0.5;
            animation: wave 10s linear infinite reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-600px); }
        }

        /* ì„ ë°• ì• ë‹ˆë©”ì´ì…˜ */
        .ship {
            position: fixed;
            bottom: 180px;
            right: -200px;
            font-size: 60px;
            animation: sail 30s linear infinite;
            z-index: 1;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        @keyframes sail {
            0% { right: -200px; }
            100% { right: 100%; }
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: #e0f2fe;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #3b82f6;
        }

        .checkbox-item label {
            cursor: pointer;
            margin: 0;
            font-size: 14px;
            color: #334155;
        }

        .search-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .pdf-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 15px;
            display: none;
        }

        .pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }

        .pdf-btn:active {
            transform: translateY(0);
        }

        .pdf-btn.show {
            display: block;
        }

        .result {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            display: none;
        }

        .result.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .result-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }

        /* PDF ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background: white;
            }

            .ocean, .ship, .header, .card form, .pdf-btn {
                display: none !important;
            }

            .container {
                max-width: 100%;
                padding: 0;
            }

            .card {
                background: white;
                box-shadow: none;
                padding: 20px;
            }

            .result {
                display: block !important;
                background: white;
                border: none;
                padding: 0;
                margin: 0;
            }

            .result h3 {
                color: #000;
                font-size: 24px;
                margin-bottom: 20px;
                page-break-after: avoid;
            }

            .result-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .result-item {
                background: white;
                border: 1px solid #ddd;
                padding: 12px;
                page-break-inside: avoid;
            }

            .result-item h4 {
                color: #000;
                font-size: 14px;
                margin-bottom: 6px;
            }

            .result-item p {
                color: #333;
                font-size: 12px;
                line-height: 1.5;
            }

            .badge {
                background: #eee;
                color: #333;
                border: 1px solid #ccc;
            }
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-item h4 {
            color: #1e3a8a;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .result-item p {
            color: #4b5563;
            line-height: 1.6;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab-btn {
            padding: 12px 30px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #64748b;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: -2px;
        }

        .tab-btn:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="ocean">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    <div class="ship">ğŸš¢</div>

    <div class="container">
        <div class="header">
            <h1>âš“ KR STABILITY</h1>
            <p>ì„ ë°•ì˜ ì¢…ë¥˜, í•­í•´êµ¬ì—­, ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì—¬ ì ìš©ë˜ëŠ” ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <div class="card">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('rules')">ğŸ” ê·œì¹™ ê²€ìƒ‰</button>
                <button class="tab-btn" onclick="switchTab('interpolation')">ğŸ“ˆ Cubic Spline ê³„ì‚°ê¸°</button>
            </div>

            <!-- ê·œì¹™ ê²€ìƒ‰ íƒ­ -->
            <div id="rulesTab" class="tab-content active">
                <form id="shipForm">
                <div class="form-group">
                    <label for="nationality">êµ­ì </label>
                    <select id="nationality" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="korean">í•œêµ­ì </option>
                        <option value="foreign">ìˆœìˆ˜ì™¸êµ­ì </option>
                        <option value="bbchp">BBCHP</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="shipType">ì„ ë°•ì˜ ì¢…ë¥˜</label>
                    <select id="shipType" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="cargo">í™”ë¬¼ì„  (Cargo Ship)</option>
                        <option value="tanker">íƒ±ì»¤ (Tanker)</option>
                        <option value="passenger">ì—¬ê°ì„  (Passenger Ship)</option>
                        <option value="container">ì»¨í…Œì´ë„ˆì„  (Container Ship)</option>
                        <option value="fishing">ì–´ì„  (Fishing Vessel)</option>
                        <option value="yacht">ìš”íŠ¸ (Yacht)</option>
                        <option value="lng">LNGì„  (LNG Carrier)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="voyageArea">í•­í•´êµ¬ì—­</label>
                    <select id="voyageArea" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ocean">ì›ì–‘ (Ocean Going)</option>
                        <option value="coastal">ê·¼í•´ (Great Coastal)</option>
                        <option value="harbor">ì—°í•´ (Coastal)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="length">ì„ ë°• ê¸¸ì´ (m)</label>
                    <input type="number" id="length" placeholder="ì˜ˆ: 100" min="1" required>
                </div>

                <div class="form-group">
                    <label>ì„ ê¸‰ë¶€í˜¸ (Class Notation)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="ice" name="notation" value="ice">
                            <label for="ice">ICE (ë¹™í•´êµ¬ì—­)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="LI" name="notation" value="LI">
                            <label for="LI">LI (ë¡œë”©ì»´í“¨í„°)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sps" name="notation" value="sps">
                            <label for="sps">SPS (íŠ¹ìˆ˜ëª©ì ì„ ì½”ë“œ)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ip" name="notation" value="ip">
                            <label for="ip">IP (ì‚°ì—…ì¸ë ¥ ìš´ì†¡ì„ ë°• ì½”ë“œ)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sfv" name="notation" value="sfv">
                            <label for="sfv">SFV (í† ë ˆëª°ë¦¬ë…¸ìŠ¤)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="blu" name="notation" value="blu">
                            <label for="blu">BLU</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="lngready" name="notation" value="lngready">
                            <label for="lngready">LNG Ready</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ammoniaready" name="notation" value="ammoniaready">
                            <label for="ammoniaready">Ammonia Ready</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ethanolready" name="notation" value="ethanolready">
                            <label for="ethanolready">Ethanol Ready</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ers" name="notation" value="ers">
                            <label for="ers">ERS</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="nbs" name="notation" value="nbs">
                            <label for="nbs">NBS</label>
                        </div>
                    </div>
                </div>

                <button type="submit" class="search-btn">ğŸ” ì ìš© ê·œì¹™ ê²€ìƒ‰</button>
            </form>

            <div id="result" class="result">
                <h3>ğŸ“‹ ì ìš©ë˜ëŠ” ê·œì¹™</h3>
                <div id="resultContent"></div>
            </div>

                <button id="pdfBtn" class="pdf-btn" onclick="downloadPDF()">
                    ğŸ–¨ï¸ PDFë¡œ ì €ì¥ (ì¸ì‡„)
                </button>
            </div>

            <!-- ë³´ê°„ ê³„ì‚°ê¸° íƒ­ -->
            <div id="interpolationTab" class="tab-content">
                <h2 style="color: #1e3a8a; margin-bottom: 20px; text-align: center;">ğŸ“ˆ Cubic Spline ë³´ê°„ ê³„ì‚°ê¸°</h2>

                <div class="form-group">
                    <label>X ê°’ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="xValues" value="10, 20, 30, 40" placeholder="ì˜ˆ: 10, 20, 30, 40">
                </div>

                <div class="form-group">
                    <label>Y ê°’ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="yValues" value="5, 10, 18, 35" placeholder="ì˜ˆ: 5, 10, 18, 35">
                </div>

                <div class="form-group">
                    <label>ë³´ê°„í•  X ê°’</label>
                    <input type="number" id="interpolateX" value="21.5" step="0.1" placeholder="ì˜ˆ: 21.5">
                </div>

                <button class="search-btn" onclick="calculateInterpolation()">ğŸ“Š ë³´ê°„ ê³„ì‚°</button>

                <div id="interpolationResult" style="display: none; margin-top: 20px; padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 10px;">
                    <h3 style="color: #1e40af; margin-bottom: 10px;">ê³„ì‚° ê²°ê³¼</h3>
                    <p id="resultText" style="font-size: 18px; font-weight: 600; color: #1e3a8a;"></p>
                </div>

                <div style="margin-top: 30px;">
                    <canvas id="interpolationChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì»¨í…ì¸ ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tabName === 'rules') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('rulesTab').classList.add('active');
            } else if (tabName === 'interpolation') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('interpolationTab').classList.add('active');
            }
        }

        // ì„ ë°• ê·œì¹™ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ (IFë¬¸ ê¸°ë°˜)
        function getRules(shipType, voyageArea, length) {
            // í•­í•´êµ¬ì—­ ê°„ì†Œí™” (harborë„ coastalë¡œ ì²˜ë¦¬)
            if (voyageArea === 'harbor') {
                voyageArea = 'coastal';
            }

            // í™”ë¬¼ì„  (Cargo Ship)
            if (shipType === 'cargo') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['SOLAS ê¸°ë³¸ ê·œì •', 'êµ­ì œ í™”ë¬¼ì„  ì•ˆì „ ì„¤ë¹„ ê·œì¹™', 'MARPOL í˜‘ì•½'];
                    } else if (length < 100) {
                        return ['SOLAS ì „ì²´ ê·œì •', 'êµ­ì œ í™”ë¬¼ì„  ì•ˆì „ ì„¤ë¹„ ê·œì¹™', 'MARPOL í˜‘ì•½', 'ISM Code'];
                    } else {
                        return ['SOLAS ì „ì²´ ê·œì •', 'êµ­ì œ í™”ë¬¼ì„  ì•ˆì „ ì„¤ë¹„ ê·œì¹™', 'MARPOL í˜‘ì•½', 'ISM Code', 'ISPS Code'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ í™”ë¬¼ì„  ì•ˆì „ ê·œì¹™', 'ì„ ë°• ì•ˆì „ë²•'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ í™”ë¬¼ì„  ì•ˆì „ ê·œì¹™', 'ì„ ë°• ì•ˆì „ë²•', 'MARPOL ì¼ë¶€ ì ìš©'];
                    } else {
                        return ['SOLAS ì¼ë¶€ ê·œì •', 'ì—°ì•ˆ í™”ë¬¼ì„  ì•ˆì „ ê·œì¹™', 'MARPOL í˜‘ì•½'];
                    }
                }
            }

            // íƒ±ì»¤ (Tanker)
            if (shipType === 'tanker') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['SOLAS ê·œì •', 'MARPOL Annex I (ìœ ë¥˜ì˜¤ì—¼ë°©ì§€)', 'IBC Code'];
                    } else if (length < 100) {
                        return ['SOLAS ê·œì •', 'MARPOL Annex I, II', 'IBC Code', 'ISM Code'];
                    } else {
                        return ['SOLAS ì „ì²´', 'MARPOL ì „ ë¶€ì†ì„œ', 'IBC Code', 'ISM Code', 'ISPS Code', 'Double Hull ìš”êµ¬ì‚¬í•­'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ íƒ±ì»¤ ì•ˆì „ ê·œì¹™', 'MARPOL Annex I'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ íƒ±ì»¤ ì•ˆì „ ê·œì¹™', 'MARPOL Annex I, II'];
                    } else {
                        return ['SOLAS ì¼ë¶€', 'MARPOL Annex I, II', 'ISM Code'];
                    }
                }
            }

            // ì—¬ê°ì„  (Passenger Ship)
            if (shipType === 'passenger') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['SOLAS Chapter III (êµ¬ëª…ì„¤ë¹„)', 'ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'LSA Code'];
                    } else if (length < 100) {
                        return ['SOLAS ì „ì²´', 'ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'LSA Code', 'ISM Code', 'Safe Return to Port'];
                    } else {
                        return ['SOLAS ì „ì²´', 'ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'LSA Code', 'ISM Code', 'ISPS Code', 'Safe Return to Port'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'êµ¬ëª…ì„¤ë¹„ ê·œì •'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'SOLAS Chapter III', 'ISM Code'];
                    } else {
                        return ['SOLAS ì¼ë¶€ ê·œì •', 'ì—°ì•ˆ ì—¬ê°ì„  ì•ˆì „ ê·œì¹™', 'ISM Code'];
                    }
                }
            }

            // ì»¨í…Œì´ë„ˆì„  (Container Ship)
            if (shipType === 'container') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['SOLAS ê¸°ë³¸ ê·œì •', 'CSS Code (í™”ë¬¼ ê³ ë°•)', 'IMDG Code'];
                    } else if (length < 100) {
                        return ['SOLAS ì „ì²´', 'CSS Code', 'IMDG Code', 'ISM Code'];
                    } else {
                        return ['SOLAS ì „ì²´', 'CSS Code', 'IMDG Code', 'ISM Code', 'ISPS Code', 'ëŒ€í˜• ì»¨í…Œì´ë„ˆì„  ì•ˆì •ì„± ê·œì •'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ í™”ë¬¼ì„  ê·œì¹™', 'CSS Code'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ í™”ë¬¼ì„  ê·œì¹™', 'CSS Code', 'IMDG Code'];
                    } else {
                        return ['SOLAS ì¼ë¶€', 'CSS Code', 'IMDG Code', 'ISM Code'];
                    }
                }
            }

            // ì–´ì„  (Fishing Vessel)
            if (shipType === 'fishing') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['ì›ì–‘ ì–´ì„  ì•ˆì „ ê·œì¹™', 'Torremolinos Protocol'];
                    } else if (length < 100) {
                        return ['ì›ì–‘ ì–´ì„  ì•ˆì „ ê·œì¹™', 'Torremolinos Protocol', 'ì–´ì„  ì•ˆì „ í˜‘ì•½'];
                    } else {
                        return ['ì›ì–‘ ì–´ì„  ì•ˆì „ ê·œì¹™', 'Torremolinos Protocol', 'ì–´ì„  ì•ˆì „ í˜‘ì•½', 'ISM Code'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ ì–´ì„  ì•ˆì „ ê·œì¹™', 'ì†Œí˜• ì–´ì„  ì•ˆì „ ê¸°ì¤€'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ ì–´ì„  ì•ˆì „ ê·œì¹™', 'ì–´ì„ ë²•'];
                    } else {
                        return ['ì—°ì•ˆ ì–´ì„  ì•ˆì „ ê·œì¹™', 'ì–´ì„ ë²•', 'Torremolinos Protocol'];
                    }
                }
            }

            // ìš”íŠ¸ (Yacht)
            if (shipType === 'yacht') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['RCD (Recreational Craft Directive)', 'ì†Œí˜• ì„ ë°• ì•ˆì „ ê¸°ì¤€'];
                    } else if (length < 100) {
                        return ['RCD', 'SOLAS ì¼ë¶€ (ììœ¨ ì ìš©)', 'ISO ì†Œí˜• ìš”íŠ¸ ê¸°ì¤€'];
                    } else {
                        return ['LY3 Code (ëŒ€í˜• ìš”íŠ¸)', 'SOLAS ì¼ë¶€', 'ISM Code (ììœ¨)'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì†Œí˜• ì„ ë°• ì•ˆì „ ê·œì¹™', 'RCD'];
                    } else if (length < 100) {
                        return ['ì†Œí˜• ì„ ë°• ì•ˆì „ ê·œì¹™', 'RCD'];
                    } else {
                        return ['ë ˆì €ì„ ë°• ì•ˆì „ ê·œì¹™', 'LY3 Code'];
                    }
                }
            }

            // LNGì„  (LNG Carrier)
            if (shipType === 'lng') {
                if (voyageArea === 'ocean') {
                    if (length < 24) {
                        return ['SOLAS ê¸°ë³¸ ê·œì •', 'IGC Code', 'MARPOL í˜‘ì•½'];
                    } else if (length < 100) {
                        return ['SOLAS ì „ì²´', 'IGC Code', 'MARPOL í˜‘ì•½', 'ISM Code'];
                    } else {
                        return ['SOLAS ì „ì²´', 'IGC Code', 'MARPOL í˜‘ì•½', 'ISM Code', 'ISPS Code', 'ê°€ìŠ¤ìš´ë°˜ì„  íŠ¹ë³„ ìš”êµ¬ì‚¬í•­'];
                    }
                } else if (voyageArea === 'coastal') {
                    if (length < 24) {
                        return ['ì—°ì•ˆ ê°€ìŠ¤ìš´ë°˜ì„  ì•ˆì „ ê·œì¹™', 'IGC Code'];
                    } else if (length < 100) {
                        return ['ì—°ì•ˆ ê°€ìŠ¤ìš´ë°˜ì„  ì•ˆì „ ê·œì¹™', 'IGC Code', 'ISM Code'];
                    } else {
                        return ['SOLAS ì¼ë¶€', 'IGC Code', 'ISM Code', 'MARPOL í˜‘ì•½'];
                    }
                }
            }

            // í•´ë‹¹ ì¡°ê±´ì´ ì—†ëŠ” ê²½ìš°
            return [];
        }

        const descriptions = {
            'SOLAS ê¸°ë³¸ ê·œì •': 'ì„ ë°•ì˜ ì•ˆì „ì„ ìœ„í•œ êµ­ì œ í˜‘ì•½ì˜ ê¸°ë³¸ ìš”êµ¬ì‚¬í•­',
            'SOLAS ì „ì²´ ê·œì •': 'ì„ ë°•ì˜ ì•ˆì „ì— ê´€í•œ êµ­ì œ í˜‘ì•½ ì „ì²´ ì±•í„° ì ìš©',
            'SOLAS ì „ì²´': 'ì„ ë°•ì˜ ì•ˆì „ì— ê´€í•œ êµ­ì œ í˜‘ì•½ ì „ì²´ ì±•í„° ì ìš©',
            'SOLAS ê·œì •': 'ì„ ë°•ì˜ ì•ˆì „ì— ê´€í•œ êµ­ì œ í˜‘ì•½',
            'MARPOL í˜‘ì•½': 'í•´ì–‘ ì˜¤ì—¼ ë°©ì§€ë¥¼ ìœ„í•œ êµ­ì œ í˜‘ì•½',
            'ISM Code': 'êµ­ì œ ì•ˆì „ê´€ë¦¬ ê·œì¹™ - ì„ ë°• ë° íšŒì‚¬ì˜ ì•ˆì „ê´€ë¦¬ ì²´ê³„',
            'ISPS Code': 'êµ­ì œ ì„ ë°• ë° í•­ë§Œì‹œì„¤ ë³´ì•ˆ ê·œì¹™',
            'IBC Code': 'ì‚°ì  í™”í•™ì œí’ˆ ìš´ì†¡ì„  ê·œì¹™',
            'LSA Code': 'êµ¬ëª…ì„¤ë¹„ ê·œì¹™',
            'CSS Code': 'í™”ë¬¼ ê³ ë°• ì•ˆì „ ê·œì¹™',
            'IMDG Code': 'êµ­ì œ í•´ìƒ ìœ„í—˜ë¬¼ ê·œì¹™',
            'Safe Return to Port': 'ì—¬ê°ì„ ì˜ ì•ˆì „í•œ ê·€í•­ ìš”êµ¬ì‚¬í•­',
            'Torremolinos Protocol': 'ì–´ì„  ì•ˆì „ êµ­ì œ í˜‘ì•½',
            'RCD': 'ë ˆì €ì„ ë°• ì§€ì¹¨',
            'LY3 Code': 'ëŒ€í˜• ìš”íŠ¸ ê·œì¹™',
            'Double Hull ìš”êµ¬ì‚¬í•­': 'ì´ì¤‘ì„ ì²´ êµ¬ì¡° ìš”êµ¬ì‚¬í•­',
            'ì„ ë°• ì•ˆì „ë²•': 'êµ­ë‚´ ì„ ë°• ì•ˆì „ì— ê´€í•œ ë²•ë¥ ',
            'ì—°ì•ˆ í™”ë¬¼ì„  ì•ˆì „ ê·œì¹™': 'ì—°ì•ˆì„ í•­í•´í•˜ëŠ” í™”ë¬¼ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'ì—°ì•ˆ íƒ±ì»¤ ì•ˆì „ ê·œì¹™': 'ì—°ì•ˆì„ í•­í•´í•˜ëŠ” íƒ±ì»¤ì˜ ì•ˆì „ ê¸°ì¤€',
            'ì—°ì•ˆ ì—¬ê°ì„  ì•ˆì „ ê·œì¹™': 'ì—°ì•ˆì„ í•­í•´í•˜ëŠ” ì—¬ê°ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'ì›ì–‘ ì–´ì„  ì•ˆì „ ê·œì¹™': 'ì›ì–‘ì„ í•­í•´í•˜ëŠ” ì–´ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'ì—°ì•ˆ ì–´ì„  ì•ˆì „ ê·œì¹™': 'ì—°ì•ˆì„ í•­í•´í•˜ëŠ” ì–´ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'ì†Œí˜• ì„ ë°• ì•ˆì „ ê·œì¹™': 'ì†Œí˜• ì„ ë°•ì˜ ì•ˆì „ ê¸°ì¤€',
            'ë ˆì €ì„ ë°• ì•ˆì „ ê·œì¹™': 'ë ˆì € ëª©ì  ì„ ë°•ì˜ ì•ˆì „ ê¸°ì¤€',
            'êµ­ì œ í™”ë¬¼ì„  ì•ˆì „ ì„¤ë¹„ ê·œì¹™': 'í™”ë¬¼ì„ ì— í•„ìš”í•œ ì•ˆì „ ì„¤ë¹„ ê·œì •',
            'ì—¬ê°ì„  ì•ˆì „ ê·œì¹™': 'ì—¬ê°ì„ ì˜ ì•ˆì „ ìš´í•­ì„ ìœ„í•œ ê·œì¹™',
            'ì–´ì„ ë²•': 'ì–´ì„ ì˜ ë“±ë¡ ë° ê´€ë¦¬ì— ê´€í•œ ë²•ë¥ ',
            'ì†Œí˜• ì–´ì„  ì•ˆì „ ê¸°ì¤€': '24ë¯¸í„° ë¯¸ë§Œ ì–´ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'êµ¬ëª…ì„¤ë¹„ ê·œì •': 'ì„ ë°• êµ¬ëª…ì„¤ë¹„ì— ê´€í•œ ê·œì •',
            'ISO ì†Œí˜• ìš”íŠ¸ ê¸°ì¤€': 'ISO êµ­ì œ í‘œì¤€ ì†Œí˜• ìš”íŠ¸ ì•ˆì „ ê¸°ì¤€',
            'MARPOL Annex I (ìœ ë¥˜ì˜¤ì—¼ë°©ì§€)': 'MARPOL ë¶€ì†ì„œ I - ìœ ë¥˜ì— ì˜í•œ ì˜¤ì—¼ ë°©ì§€',
            'MARPOL Annex I': 'MARPOL ë¶€ì†ì„œ I - ìœ ë¥˜ì— ì˜í•œ ì˜¤ì—¼ ë°©ì§€',
            'MARPOL Annex I, II': 'MARPOL ë¶€ì†ì„œ I(ìœ ë¥˜), II(ì‚°ì  ìœ í•´ì•¡ì²´ë¬¼ì§ˆ) ì˜¤ì—¼ ë°©ì§€',
            'MARPOL ì „ ë¶€ì†ì„œ': 'MARPOL í˜‘ì•½ ëª¨ë“  ë¶€ì†ì„œ(I-VI) ì ìš©',
            'MARPOL ì¼ë¶€ ì ìš©': 'MARPOL í˜‘ì•½ ì¤‘ ì¼ë¶€ ë¶€ì†ì„œ ì ìš©',
            'ëŒ€í˜• ì»¨í…Œì´ë„ˆì„  ì•ˆì •ì„± ê·œì •': 'ëŒ€í˜• ì»¨í…Œì´ë„ˆì„ ì˜ ë³µì›ì„± ë° ì•ˆì •ì„± ê°•í™” ê·œì •',
            'SOLAS Chapter III (êµ¬ëª…ì„¤ë¹„)': 'SOLAS í˜‘ì•½ ì œ3ì¥ - êµ¬ëª…ì„¤ë¹„ ë° ì¥ì¹˜',
            'SOLAS Chapter III': 'SOLAS í˜‘ì•½ ì œ3ì¥ - êµ¬ëª…ì„¤ë¹„ ë° ì¥ì¹˜',
            'SOLAS ì¼ë¶€ ê·œì •': 'SOLAS í˜‘ì•½ ì¤‘ í•´ë‹¹ ì„ ë°•ì— ì ìš©ë˜ëŠ” ì¼ë¶€ ì±•í„°',
            'SOLAS ì¼ë¶€': 'SOLAS í˜‘ì•½ ì¤‘ í•´ë‹¹ ì„ ë°•ì— ì ìš©ë˜ëŠ” ì¼ë¶€ ì±•í„°',
            'SOLAS ì¼ë¶€ (ììœ¨ ì ìš©)': 'SOLAS í˜‘ì•½ ì¤‘ ììœ¨ì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„',
            'ISM Code (ììœ¨)': 'êµ­ì œ ì•ˆì „ê´€ë¦¬ ê·œì¹™ - ììœ¨ ì ìš©',
            'ì†Œí˜• ì„ ë°• ì•ˆì „ ê¸°ì¤€': 'ì†Œí˜• ì„ ë°•ì˜ ì•ˆì „ ìš´í•­ì„ ìœ„í•œ ê¸°ì¤€',
            'ì–´ì„  ì•ˆì „ í˜‘ì•½': 'ì–´ì„ ì˜ ì•ˆì „ì— ê´€í•œ êµ­ì œ í˜‘ì•½',
            'IGC Code': 'êµ­ì œ ê°€ìŠ¤ìš´ë°˜ì„  ê·œì¹™ - ì•¡í™”ê°€ìŠ¤ ì‚°ì  ìš´ì†¡ì„  êµ¬ì¡° ë° ì„¤ë¹„',
            'ì—°ì•ˆ ê°€ìŠ¤ìš´ë°˜ì„  ì•ˆì „ ê·œì¹™': 'ì—°ì•ˆì„ í•­í•´í•˜ëŠ” ê°€ìŠ¤ìš´ë°˜ì„ ì˜ ì•ˆì „ ê¸°ì¤€',
            'ê°€ìŠ¤ìš´ë°˜ì„  íŠ¹ë³„ ìš”êµ¬ì‚¬í•­': 'ì•¡í™”ê°€ìŠ¤ ìš´ë°˜ì„ ì˜ í™”ë¬¼ ê²©ë‚©, ì•ˆì „ì„¤ë¹„ íŠ¹ë³„ ìš”êµ¬ì‚¬í•­',

            'ë¹™í•´ìš´í•­ì„ ë°• ì§€ì¹¨': 'ë¹™í•´ êµ¬ì—­ ìš´í•­ì„ ìœ„í•œ ì„ ì²´ ê°•í™” ë° ì¶”ê°€ ì„¤ë¹„ ìš”êµ¬ì‚¬í•­',
            'Polar Code': 'ê·¹ì§€ ìš´í•­ ì„ ë°•ì— ëŒ€í•œ ì•ˆì „ ë° í™˜ê²½ë³´í˜¸ ê·œì¹™',

            'TEST REPORT': 'UR L5',

            'SPS Code': 'íŠ¹ìˆ˜ëª©ì ì„  ì•ˆì „ ê·œì¹™ (Special Purpose Ship Code)',
            'IP Code': 'ì‚°ì—…ì¸ë ¥ ìš´ì†¡ì„ ë°• ì•ˆì „ ê·œì¹™ (Industrial Personnel Code)',
            'SFV Protocol': 'ì–´ì„  ì•ˆì „ì„ ìœ„í•œ í† ë ˆëª°ë¦¬ë…¸ìŠ¤ ì˜ì •ì„œ (Torremolinos Protocol for Safety of Fishing Vessels)',
            'BLU ê´€ë ¨ ì§€ì¹¨': 'ì§€ì¹¨ 3í¸ ë¶€ë¡ 3-1',
            'LNG Ready': 'LNG ì—°ë£Œ ì „í™˜ ì¤€ë¹„ ì„ ë°• ìš”êµ¬ì‚¬í•­',
            'Ammonia Ready': 'ì•”ëª¨ë‹ˆì•„ ì—°ë£Œ ì „í™˜ ì¤€ë¹„ ì„ ë°• ìš”êµ¬ì‚¬í•­',
            'Ethanol Ready': 'ì—íƒ„ì˜¬ ì—°ë£Œ ì „í™˜ ì¤€ë¹„ ì„ ë°• ìš”êµ¬ì‚¬í•­',
            'ERS Code': 'ë¹„ìƒì˜ˆì¸ì¥ì¹˜ ìš”êµ¬ì‚¬í•­ (Emergency Response Service)',
            'NBS Code': 'ì„ ë°• ì†ŒìŒ ì €ê° ê·œì¹™ (Noise and Vibration)'
        };

        // ì„ ê¸‰ë¶€í˜¸ì— ë”°ë¥¸ ì¶”ê°€ ê·œì¹™ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function getNotationRules(notations) {
            const additionalRules = [];

            if (notations.includes('ice')) {
                additionalRules.push('ë¹™í•´ìš´í•­ì„ ë°• ì§€ì¹¨');
            }
            if (notations.includes('LI')) {
                additionalRules.push('TEST REPORT');
            }
            if (notations.includes('sps')) {
                additionalRules.push('SPS Code');
            }
            if (notations.includes('ip')) {
                additionalRules.push('IP Code');
            }
            if (notations.includes('sfv')) {
                additionalRules.push('SFV Protocol');
            }
            if (notations.includes('blu')) {
                additionalRules.push('BLU ê´€ë ¨ ì§€ì¹¨');
            }
            if (notations.includes('lngready')) {
                additionalRules.push('LNG Ready');
            }
            if (notations.includes('ammoniaready')) {
                additionalRules.push('Ammonia Ready');
            }
            if (notations.includes('ethanolready')) {
                additionalRules.push('Ethanol Ready');
            }
            if (notations.includes('ers')) {
                additionalRules.push('ERS Code');
            }
            if (notations.includes('nbs')) {
                additionalRules.push('NBS Code');
            }

            return additionalRules;
        }

        document.getElementById('shipForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // INPUT: êµ­ì , ì„ ë°•ì˜ ì¢…ë¥˜, í•­í•´êµ¬ì—­, ê¸¸ì´
            const nationality = document.getElementById('nationality').value;
            const shipType = document.getElementById('shipType').value;
            const voyageArea = document.getElementById('voyageArea').value;
            const length = parseInt(document.getElementById('length').value);

            // ì„ íƒëœ ì„ ê¸‰ë¶€í˜¸ ê°€ì ¸ì˜¤ê¸°
            const checkboxes = document.querySelectorAll('input[name="notation"]:checked');
            const notations = Array.from(checkboxes).map(cb => cb.value);

            // IFë¬¸ ê¸°ë°˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì ìš© ê·œì¹™ ê°€ì ¸ì˜¤ê¸°
            const basicRules = getRules(shipType, voyageArea, length);

            // ì„ ê¸‰ë¶€í˜¸ì— ë”°ë¥¸ ì¶”ê°€ ê·œì¹™ ê°€ì ¸ì˜¤ê¸°
            const notationRules = notations.length > 0 ? getNotationRules(notations) : [];

            // OUTPUT: ê²°ê³¼ í‘œì‹œ
            displayResults(basicRules, notationRules, nationality, shipType, voyageArea, length, notations);
        });

        function displayResults(basicRules, notationRules, nationality, shipType, voyageArea, length, notations = []) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            const totalRules = basicRules.length + notationRules.length;

            if (totalRules === 0) {
                resultContent.innerHTML = '<p style="color: #ef4444;">í•´ë‹¹ ì¡°ê±´ì— ëŒ€í•œ ê·œì¹™ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                let html = '<div style="margin-bottom: 20px;">';
                html += `<span class="badge">êµ­ì : ${getNationalityName(nationality)}</span>`;
                html += `<span class="badge">ì„ ë°• ì¢…ë¥˜: ${getShipTypeName(shipType)}</span>`;
                html += `<span class="badge">í•­í•´êµ¬ì—­: ${getVoyageAreaName(voyageArea)}</span>`;
                html += `<span class="badge">ê¸¸ì´: ${length}m</span>`;

                // ì„ ê¸‰ë¶€í˜¸ í‘œì‹œ
                if (notations.length > 0) {
                    const notationNames = {
                        'ice': 'ICE',
                        'LI': 'LI',
                        'sps': 'SPS',
                        'ip': 'IP',
                        'sfv': 'SFV',
                        'blu': 'BLU',
                        'lngready': 'LNG Ready',
                        'ammoniaready': 'Ammonia Ready',
                        'ethanolready': 'Ethanol Ready',
                        'ers': 'ERS',
                        'nbs': 'NBS'
                    };
                    notations.forEach(notation => {
                        html += `<span class="badge" style="background: #059669;">${notationNames[notation]}</span>`;
                    });
                }

                html += '</div>';

                // 3ì»¬ëŸ¼ ê·¸ë¦¬ë“œ ì‹œì‘
                html += '<div class="result-grid">';

                // ê¸°ë³¸ ê·œì¹™ í‘œì‹œ (íŒŒë€ìƒ‰)
                basicRules.forEach(rule => {
                    html += `
                        <div class="result-item">
                            <h4>âœ“ ${rule}</h4>
                            <p>${descriptions[rule] || 'ê·œì¹™ ì„¤ëª…ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.'}</p>
                        </div>
                    `;
                });

                // ì„ ê¸‰ë¶€í˜¸ ê·œì¹™ í‘œì‹œ (ì´ˆë¡ìƒ‰)
                notationRules.forEach(rule => {
                    html += `
                        <div class="result-item" style="border-left: 4px solid #10b981; background: #f0fdf4;">
                            <h4 style="color: #059669;">âœ“ ${rule}</h4>
                            <p>${descriptions[rule] || 'ê·œì¹™ ì„¤ëª…ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.'}</p>
                        </div>
                    `;
                });

                // ê·¸ë¦¬ë“œ ì¢…ë£Œ
                html += '</div>';

                resultContent.innerHTML = html;
            }

            resultDiv.classList.add('show');

            // PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
            const pdfBtn = document.getElementById('pdfBtn');
            if (totalRules > 0) {
                pdfBtn.classList.add('show');
            } else {
                pdfBtn.classList.remove('show');
            }
        }

        function downloadPDF() {
            // ë¸Œë¼ìš°ì € ë„¤ì´í‹°ë¸Œ PDF ì¶œë ¥ ì‚¬ìš© (ìµœê³  í™”ì§ˆ)
            window.print();
        }

        function getShipTypeName(type) {
            const names = {
                cargo: 'í™”ë¬¼ì„ ',
                tanker: 'íƒ±ì»¤',
                passenger: 'ì—¬ê°ì„ ',
                container: 'ì»¨í…Œì´ë„ˆì„ ',
                fishing: 'ì–´ì„ ',
                yacht: 'ìš”íŠ¸',
                lng: 'LNGì„ '
            };
            return names[type] || type;
        }

        function getVoyageAreaName(area) {
            const names = {
                ocean: 'ì›ì–‘',
                coastal: 'ê·¼í•´',
                harbor: 'ì—°í•´',
                river: 'ë‚´ìˆ˜ë©´'
            };
            return names[area] || area;
        }

        function getNationalityName(nationality) {
            const names = {
                korean: 'í•œêµ­ì ',
                foreign: 'ìˆœìˆ˜ì™¸êµ­ì ',
                bbchp: 'BBCHP'
            };
            return names[nationality] || nationality;
        }

        // ===== Cubic Spline ë³´ê°„ ê³„ì‚°ê¸° =====

        // Cubic Spline í´ë˜ìŠ¤
        class CubicSpline {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.n = x.length;
                this.calculateCoefficients();
            }

            calculateCoefficients() {
                const n = this.n - 1;
                const h = [];
                const alpha = [];

                // Calculate h and alpha
                for (let i = 0; i < n; i++) {
                    h[i] = this.x[i + 1] - this.x[i];
                }

                for (let i = 1; i < n; i++) {
                    alpha[i] = (3 / h[i]) * (this.y[i + 1] - this.y[i]) -
                               (3 / h[i - 1]) * (this.y[i] - this.y[i - 1]);
                }

                // Solve tridiagonal system
                const l = [1];
                const mu = [0];
                const z = [0];

                for (let i = 1; i < n; i++) {
                    l[i] = 2 * (this.x[i + 1] - this.x[i - 1]) - h[i - 1] * mu[i - 1];
                    mu[i] = h[i] / l[i];
                    z[i] = (alpha[i] - h[i - 1] * z[i - 1]) / l[i];
                }

                l[n] = 1;
                z[n] = 0;

                this.c = new Array(this.n).fill(0);
                this.b = new Array(n);
                this.d = new Array(n);

                for (let j = n - 1; j >= 0; j--) {
                    this.c[j] = z[j] - mu[j] * this.c[j + 1];
                    this.b[j] = (this.y[j + 1] - this.y[j]) / h[j] -
                                h[j] * (this.c[j + 1] + 2 * this.c[j]) / 3;
                    this.d[j] = (this.c[j + 1] - this.c[j]) / (3 * h[j]);
                }
            }

            interpolate(xi) {
                // Find the right interval
                let i = 0;
                for (i = 0; i < this.n - 1; i++) {
                    if (xi <= this.x[i + 1]) break;
                }

                if (i >= this.n - 1) i = this.n - 2;

                const dx = xi - this.x[i];
                return this.y[i] +
                       this.b[i] * dx +
                       this.c[i] * dx * dx +
                       this.d[i] * dx * dx * dx;
            }
        }

        let interpolationChart = null;

        function calculateInterpolation() {
            try {
                // Parse input values
                const xInput = document.getElementById('xValues').value;
                const yInput = document.getElementById('yValues').value;
                const interpolateX = parseFloat(document.getElementById('interpolateX').value);

                const xValues = xInput.split(',').map(v => parseFloat(v.trim()));
                const yValues = yInput.split(',').map(v => parseFloat(v.trim()));

                // Validate inputs
                if (xValues.length !== yValues.length) {
                    alert('X ê°’ê³¼ Y ê°’ì˜ ê°œìˆ˜ê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                if (xValues.length < 3) {
                    alert('ìµœì†Œ 3ê°œ ì´ìƒì˜ ë°ì´í„° í¬ì¸íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                if (xValues.some(isNaN) || yValues.some(isNaN) || isNaN(interpolateX)) {
                    alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // Create cubic spline
                const spline = new CubicSpline(xValues, yValues);

                // Calculate interpolated value
                const interpolatedY = spline.interpolate(interpolateX);

                // Display result
                document.getElementById('resultText').textContent =
                    `X = ${interpolateX}ì—ì„œ ë³´ê°„ëœ ê°’: Y = ${interpolatedY.toFixed(4)}`;
                document.getElementById('interpolationResult').style.display = 'block';

                // Generate curve data
                const minX = Math.min(...xValues);
                const maxX = Math.max(...xValues);
                const curveX = [];
                const curveY = [];
                const step = (maxX - minX) / 1000;

                for (let x = minX; x <= maxX; x += step) {
                    curveX.push(x);
                    curveY.push(spline.interpolate(x));
                }

                // Draw chart
                drawInterpolationChart(xValues, yValues, curveX, curveY, interpolateX, interpolatedY);

            } catch (error) {
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                console.error(error);
            }
        }

        function drawInterpolationChart(xValues, yValues, curveX, curveY, findX, findY) {
            const ctx = document.getElementById('interpolationChart').getContext('2d');

            if (interpolationChart) {
                interpolationChart.destroy();
            }

            interpolationChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Interpolation',
                            data: curveX.map((x, i) => ({x: x, y: curveY[i]})),
                            borderColor: 'rgba(0, 0, 0, 1)',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            tension: 0,
                            type: 'line'
                        },
                        {
                            label: 'Given value',
                            data: xValues.map((x, i) => ({x: x, y: yValues[i]})),
                            borderColor: 'rgba(30, 58, 138, 1)',
                            backgroundColor: 'rgba(30, 58, 138, 1)',
                            pointRadius: 8,
                            pointStyle: 'circle',
                            pointBorderWidth: 2,
                            pointBorderColor: 'rgba(30, 58, 138, 1)'
                        },
                        {
                            label: 'Find value',
                            data: [{x: findX, y: findY}],
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 1)',
                            pointRadius: 15,
                            pointStyle: 'rectRot',
                            pointBorderWidth: 3,
                            pointBorderColor: 'rgba(239, 68, 68, 1)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Interpolation & Find value',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `X: ${context.parsed.x.toFixed(3)}, Y: ${context.parsed.y.toFixed(4)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'X'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Y'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
